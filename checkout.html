<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>結帳 | YCCT 購物網</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body style="background: linear-gradient(135deg, #f8fafc 0%, #e0e7ff 100%);">
<div class="container py-5">
    <div class="mx-auto" style="max-width:900px;">
        <div class="bg-white rounded-4 shadow-lg p-4 mb-4">
            <h2 class="mb-4 fw-bold text-primary"><i class="bi bi-credit-card me-2"></i>結帳</h2>
            <div id="checkout-cart"></div>
            <hr>
            <form id="checkout-form" class="mt-4">
                <h5 class="mb-3 fw-bold">選擇付款/取貨方式</h5>
                <div class="row g-3 mb-3">
                    <div class="col-md-4">
                        <div class="form-check border rounded-3 p-3 h-100">
                            <input class="form-check-input" type="radio" name="payType" id="payCard" value="信用卡" checked>
                            <label class="form-check-label" for="payCard">
                                <i class="bi bi-credit-card-2-front me-1"></i> 信用卡
                            </label>
                            <div class="mt-2 ms-4" id="card-fields">
                                <input type="text" class="form-control mb-2" placeholder="卡號 (16碼)" maxlength="16" pattern="\d{16}">
                                <input type="text" class="form-control mb-2" placeholder="持卡人姓名">
                                <div class="row g-2">
                                    <div class="col">
                                        <input type="text" class="form-control" placeholder="MM/YY" maxlength="5">
                                    </div>
                                    <div class="col">
                                        <input type="text" class="form-control" placeholder="CVC" maxlength="3">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-check border rounded-3 p-3 h-100">
                            <input class="form-check-input" type="radio" name="payType" id="payBank" value="銀行轉帳">
                            <label class="form-check-label" for="payBank">
                                <i class="bi bi-bank me-1"></i> 銀行轉帳
                            </label>
                            <div class="mt-2 ms-4 d-none" id="bank-fields">
                                <div class="text-secondary small">請於下單後三日內轉帳至：</div>
                                <div class="fw-bold">銀行：004 台灣銀行<br>帳號：12345678901234</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-check border rounded-3 p-3 h-100">
                            <input class="form-check-input" type="radio" name="payType" id="payStore" value="超商取貨">
                            <label class="form-check-label" for="payStore">
                                <i class="bi bi-shop me-1"></i> 超商取貨付款
                            </label>
                            <div class="mt-2 ms-4 d-none" id="store-fields">
                                <select class="form-select mb-2">
                                    <option selected disabled>選擇超商</option>
                                    <option>7-11</option>
                                    <option>全家</option>
                                    <option>萊爾富</option>
                                    <option>OK超商</option>
                                </select>
                                <input type="text" class="form-control" placeholder="門市名稱/地址">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="text-end mt-4">
                    <button type="submit" class="btn btn-gradient rounded-pill px-5 py-2 fw-bold fs-5">
                        <i class="bi bi-check-circle me-2"></i>確認結帳
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
<style>
    .btn-gradient {
        background: linear-gradient(90deg, #6366f1 0%, #818cf8 100%);
        color: #fff;
        border: none;
    }
    .btn-gradient:hover {
        background: linear-gradient(90deg, #818cf8 0%, #6366f1 100%);
        color: #fff;
    }
    .form-check-input:checked {
        border-color: #6366f1;
        background-color: #6366f1;
    }
</style>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
function renderCheckoutCart() {
    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    const cartDiv = document.getElementById('checkout-cart');
    if (cart.length === 0) {
        cartDiv.innerHTML = `
            <div class="alert alert-info text-center">
                <i class="bi bi-cart-x fs-1"></i><br>您的購物車是空的
            </div>`;
        document.getElementById('checkout-form').style.display = 'none';
        return;
    }
    let total = 0;
    let html = `
    <div class="table-responsive">
        <table class="table align-middle bg-white rounded-3 shadow-sm">
            <thead>
                <tr>
                    <th>商品</th>
                    <th>單價</th>
                    <th>數量</th>
                    <th>小計</th>
                </tr>
            </thead>
            <tbody>
    `;
    cart.forEach(item => {
        const price = parseInt(item.price.replace(/[^\d]/g, '')) || 0;
        const qty = item.qty || 1;
        const subtotal = price * qty;
        total += subtotal;
        html += `
            <tr>
                <td>
                    <img src="${item.img}" alt="${item.title}" style="width:48px;height:48px;object-fit:cover;border-radius:8px;margin-right:8px;">
                    ${item.title}
                </td>
                <td>${item.price}</td>
                <td>${qty}</td>
                <td>NT$${subtotal.toLocaleString()}</td>
            </tr>
        `;
    });
    html += `
            </tbody>
        </table>
    </div>
    <div class="text-end fs-5 fw-bold mt-3">總金額：<span class="text-danger">NT$${total.toLocaleString()}</span></div>
    `;
    cartDiv.innerHTML = html;
}
window.addEventListener('DOMContentLoaded', renderCheckoutCart);

// 切換付款方式顯示對應欄位
document.addEventListener('DOMContentLoaded', function() {
    function toggleFields() {
        document.getElementById('card-fields').style.display = document.getElementById('payCard').checked ? '' : 'none';
        document.getElementById('bank-fields').classList.toggle('d-none', !document.getElementById('payBank').checked);
        document.getElementById('store-fields').classList.toggle('d-none', !document.getElementById('payStore').checked);
    }
    document.querySelectorAll('input[name="payType"]').forEach(radio => {
        radio.addEventListener('change', toggleFields);
    });
    toggleFields();
});

// 結帳送出
document.getElementById('checkout-form').addEventListener('submit', function(e) {
    e.preventDefault();
    alert('感謝您的訂購！訂單已成立。');
    localStorage.removeItem('cart');
    window.location.href = 'home.html';
});
</script>
</body>
</html>